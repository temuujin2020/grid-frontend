<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Esports Matches Widget</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #0a0a0a;
            color: #ffffff;
            overflow-x: hidden;
        }
        
        .widget-container {
            max-width: 100%;
            padding: 10px;
        }
        
        .widget-header {
            text-align: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #333;
        }
        
        .widget-title {
            font-size: 18px;
            font-weight: 600;
            color: #00ff88;
            margin-bottom: 5px;
        }
        
        .widget-subtitle {
            font-size: 12px;
            color: #888;
        }
        
        .matches-container {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 5px 0;
            scrollbar-width: thin;
            scrollbar-color: #333 #111;
        }
        
        .matches-container::-webkit-scrollbar {
            height: 6px;
        }
        
        .matches-container::-webkit-scrollbar-track {
            background: #111;
            border-radius: 3px;
        }
        
        .matches-container::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 3px;
        }
        
        .match-card {
            min-width: 280px;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 12px;
            flex-shrink: 0;
            transition: all 0.2s ease;
        }
        
        .match-card:hover {
            border-color: #00ff88;
            transform: translateY(-2px);
        }
        
        .match-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .game-type {
            background: #00ff88;
            color: #000;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
        }
        
        .match-status {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: 600;
        }
        
        .status-live {
            background: #ff0000;
            color: white;
        }
        
        .status-upcoming {
            background: #ffaa00;
            color: #000;
        }
        
        .teams {
            margin-bottom: 8px;
        }
        
        .team {
            display: flex;
            align-items: center;
            margin-bottom: 4px;
            font-size: 14px;
        }
        
        .team-name {
            font-weight: 500;
        }
        
        .vs {
            text-align: center;
            color: #666;
            font-size: 12px;
            margin: 5px 0;
        }
        
        .match-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 11px;
            color: #888;
        }
        
        .tournament {
            font-weight: 500;
        }
        
        .time {
            color: #00ff88;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #888;
        }
        
        .error {
            text-align: center;
            padding: 20px;
            color: #ff4444;
        }
        
        .no-matches {
            text-align: center;
            padding: 20px;
            color: #888;
        }
    </style>
</head>
<body>
    <div class="widget-container">
        <div class="widget-header">
            <div class="widget-title">Live Matches</div>
            <div class="widget-subtitle">CS2 & DOTA 2</div>
        </div>
        
        <div id="matches-container" class="matches-container">
            <div class="loading">Loading matches...</div>
        </div>
    </div>

    <script>
        const PANDASCORE_API = "https://api.pandascore.co";
        const PANDASCORE_TOKEN = "F9aH4N1Sy6lQcNqQlEgPYnXHzXKfbdPzyGo-8dC6KySNDQVFpDY";
        
        function formatTime(timeString) {
            if (!timeString) return 'TBD';
            
            try {
                const date = new Date(timeString);
                const now = new Date();
                const diffMs = date.getTime() - now.getTime();
                const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
                
                if (diffDays === 0) {
                    return `Today ${date.toLocaleTimeString([], { hour: 'numeric', minute: '2-digit' })}`;
                } else if (diffDays === 1) {
                    return `Tomorrow ${date.toLocaleTimeString([], { hour: 'numeric', minute: '2-digit' })}`;
                } else if (diffDays > 1 && diffDays <= 7) {
                    return date.toLocaleDateString([], { weekday: 'short', hour: 'numeric', minute: '2-digit' });
                } else {
                    return date.toLocaleDateString([], { month: 'short', day: 'numeric' });
                }
            } catch (error) {
                return 'TBD';
            }
        }
        
        function getGameType(match) {
            if (match.game) return match.game;
            
            const eventName = (match.event || '').toLowerCase();
            if (eventName.includes('dota')) return 'DOTA 2';
            if (eventName.includes('cs') || eventName.includes('counter')) return 'CS2';
            
            return 'CS2';
        }
        
        function normalizeMatch(match, gameType) {
            const team1 = match.opponents?.[0]?.opponent;
            const team2 = match.opponents?.[1]?.opponent;
            
            return {
                id: match.id,
                teams: [
                    { name: team1?.name || 'TBD' },
                    { name: team2?.name || 'TBD' }
                ],
                event: match.league?.name || match.tournament?.name || 'Unknown Tournament',
                time: match.scheduled_at || match.begin_at || '',
                status: match.status,
                game: gameType
            };
        }
        
        async function loadMatches() {
            try {
                const container = document.getElementById('matches-container');
                
                const [cs2LiveRes, cs2UpcomingRes, dota2LiveRes, dota2UpcomingRes] = await Promise.all([
                    fetch(`${PANDASCORE_API}/csgo/matches/running?token=${PANDASCORE_TOKEN}&per_page=10`).then(r => r.json()),
                    fetch(`${PANDASCORE_API}/csgo/matches/upcoming?token=${PANDASCORE_TOKEN}&per_page=10`).then(r => r.json()),
                    fetch(`${PANDASCORE_API}/dota2/matches/running?token=${PANDASCORE_TOKEN}&per_page=10`).then(r => r.json()),
                    fetch(`${PANDASCORE_API}/dota2/matches/upcoming?token=${PANDASCORE_TOKEN}&per_page=10`).then(r => r.json())
                ]);
                
                const allMatches = [
                    ...(cs2LiveRes || []).map(match => normalizeMatch(match, 'CS2')),
                    ...(cs2UpcomingRes || []).map(match => normalizeMatch(match, 'CS2')),
                    ...(dota2LiveRes || []).map(match => normalizeMatch(match, 'DOTA 2')),
                    ...(dota2UpcomingRes || []).map(match => normalizeMatch(match, 'DOTA 2'))
                ].filter(match => !match.event?.includes('GRID-TEST'));
                
                if (allMatches.length === 0) {
                    container.innerHTML = '<div class="no-matches">No matches found</div>';
                    return;
                }
                
                container.innerHTML = allMatches.map(match => `
                    <div class="match-card">
                        <div class="match-header">
                            <span class="game-type">${getGameType(match)}</span>
                            <span class="match-status ${match.status === 'running' ? 'status-live' : 'status-upcoming'}">
                                ${match.status === 'running' ? 'LIVE' : 'UPCOMING'}
                            </span>
                        </div>
                        <div class="teams">
                            <div class="team">${match.teams[0].name}</div>
                            <div class="vs">VS</div>
                            <div class="team">${match.teams[1].name}</div>
                        </div>
                        <div class="match-info">
                            <span class="tournament">${match.event}</span>
                            <span class="time">${formatTime(match.time)}</span>
                        </div>
                    </div>
                `).join('');
                
            } catch (error) {
                document.getElementById('matches-container').innerHTML = 
                    '<div class="error">Error loading matches</div>';
            }
        }
        
        // Load matches on page load
        loadMatches();
        
        // Refresh every 30 seconds
        setInterval(loadMatches, 30000);
    </script>
</body>
</html>
